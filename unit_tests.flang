###
Unit tests for flang - language
 language: flang
 author: mystikkogames ( mystikkogames@protonmail.com )
 license: GPLv2
###

( include "utils.flang" )

( function :flang_unit_tests ( ) :
    
    # POSITIVE
          
    ( "1 2 3 4 5 6 " :remove_whitespace "123456" == :assert )
    ( "a b c d e f " :remove_whitespace "abcdef" == :assert )
    ( " " :is_whitespace :assert )
    
    ( "sdf 012-12-1 dfdsf" "/\d{3}-\d{2}-\d{1}/" :regex_match :assert )    
    ( "sdf 012dfdsf" "/[0-9]{3}/" :regex_match :assert )    
    ( "sdf 040-1234567 dfdsf" "/[0-9]{3}-[0-9]{7}/" :regex_match :assert )    
    ( "040-1234567 dfdsf" "/^[0-9]{3}-[0-9]{7}/" :regex_match :assert )    
  
    ( $o ["r": 24, "g": 33, "b": 55, "x": 22, "y": 42, "cells": [2, 5, 42]] = ) 
    ( $o ".g" -> 33 == :assert )
    ( $o ".y" -> 42 == :assert )
    ( $o ".x" -> 22 == :assert )
    ( $o ".cells.2" -> 42 == :assert )

    ( $o [ 1, 5, "some": [ 2, 4] ] = ) 
    ( $o ".some.0" -> 2 == :assert )
    ( $o ".some.0" 112 <- )
    ( $o ".length" 112 <- )
    ( $o :flat :print )
    
    
    
    
    ( $o [] = ) 
    ( $o ".x" 125 <-  ) 
    ( $o ".x" -> 125 == :assert )

    ( 25 :sqrt 5 - :abs 0.1 < :assert ) 
    ( 100 :sqrt 10 - :abs 0.1 < :assert ) 
    
    ( -100 :abs 100 == :assert ) 
    ( 100 :abs 100 == :assert ) 
        
    ( 2 :floor 2 == :assert ) 
    ( 2.4 :floor 2 == :assert )    
    ( 2.9 :floor 2 == :assert )    
    ( -2.7 :floor -3 == :assert )  
    ( -2 :floor -2 == :assert )
    
    ( 2 :ceil 2 == :assert )
    ( 2.4 :ceil 3 == :assert )
    ( 2.9 :ceil 3 == :assert )
    ( -2.7 :ceil -2 :assert ) 
    ( -2 :ceil -2 :assert ) 
         
    ( $var "abc" = ) 
    ( $var2 "def" = ) 
    ( $var $var2 :join "abcdef" == :assert ) 
    ( "abc" "def" :join "abcdef" == :assert )    
    ( "mystikko" "games" :join "mystikkogames" == :assert )    
    ( "123" "321" :join "123321" == :assert )     
	
    ( "abcdef" "bcd" :contain :assert )
    ( "abcde484f" "484" :contain :assert )

    ( $var [] = ) 
    ( $var 1 :push ) 
    ( $var 2 :push ) 
    ( $var 3 :push ) 
    ( $var 42 :push ) 
    ( $var 3 :get 42 == :assert )
    ( $var :len 4 == :assert )
    
    ( $var [ "name": "mystikkogames" ] = ) 
    ( $var ".name" 42 <- )
    ( $var ".name" -> 42 == :assert )
    
    ( $multiply_by_2 ( lambda ( $num ) : ( $num 2 * ) ) = )
    ( 7 :$multiply_by_2 14 == :assert )
    ( 21 :$multiply_by_2 42 == :assert )
    ( $var2 $multiply_by_2 = )
    ( 21 :$var2 42 == :assert )

    ( $cruncher ( lambda ( $func1 $func2 ) : ( $a :$func1 = ) ( $b :$func2 = ) ( if ( $a $b > ) : ( $a ) else : ( $b ) ) ) = )
    # We can pass lambdas as arguments to functions!
    ( ( lambda ( ) : ( 11 ) ) ( lambda ( ) : ( 42 ) ) :$cruncher 42 == :assert )
        
    ( "1" :assert )    
    ( "..." :assert )    
    ( "0.0" :assert )
        
   	( $var 42 = )
   	( if ( 1 ) : ( $var 142 = ) )
    ( $var 142 == :assert )
   	
   	( $var 42 = )
   	( if ( 0 ) : ( $var 0 = ) else : ( $var 111 = ) )
    ( $var 111 == :assert )

   	( $var 42 = )
   	( if ( 0 ) : ( $var 0 = ) elif ( 1 ) : ( $var 19 = ) else : ( $var 111 = ) )
    ( $var 19 == :assert )
    
   	( $var 42 = )
   	( $var 10 %= )
   	( $var 2 == :assert )

   	( $var 42 = )
   	( $var 2 %= )
   	( $var 0 == :assert )

   	( $var 42 = )
   	( $var 2 -= )
   	( $var 40 == :assert )

   	( $var 42 = )
   	( $var 44 -= )
   	( $var -2 == :assert )

   	( $var 42 = )
   	( $var 2 += )
   	( $var 44 == :assert )

   	( $var 42 = )
   	( $var 2 /= )
   	( $var :floor 21 == :assert )

   	( $var 42 = )
   	( $var 42 /= )
   	( $var :floor 1 == :assert )

   	( $var 42 = )
   	( $var 2 *= )
   	( $var 84 == :assert )

   	( $var 42 = )
   	( $var -2 *= )
   	( $var -84 == :assert )

   	( $var 42 = )
   	( $var ++ )
   	( $var 43 == :assert )

   	( $var 42 = )
   	( $var -- )
   	( $var 41 == :assert )
    
   	( $var 100 = )
   	( $var 10 -= )
    ( $var 90 == :assert )
    
   	( $var 100 = )
   	( $var 10 += )
    ( $var 110 == :assert )
        
   	( $IAMGLOBAL 42 = )
   	( $IAMGLOBAL 42 == :assert )
   	
    ( 0 :sin 0.1 < :assert )
    ( 0 :cos 0.9 > :assert )

    # NEGATIVE

    ( "0" ! :assert ) # Only "0" is false in flang. Everything else is true! 

    ( "abcde484f" "000" :contain ! :assert )
    ( "abcde123123484f" "trim" :contain ! :assert )

    ( "sdf 040-1234567 dfdsf" "/^[0-9]{3}-[0-9]{7}/" :regex_match ! :assert )    
    ( "sdf 012dfdsf" "/[0-9]{4}/" :regex_match ! :assert )
        
)

( function :main ( ) :

    ( :clock_start )
    ( :flang_unit_tests )
    ( :clock_diff "flang unit tests # %.3fs" :printf )

)

